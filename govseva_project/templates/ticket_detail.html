{% extends "base.html" %}
{% block content %}
<h2>Ticket #{{ t.id }} - {{ t.title }}</h2>
<div class="card mb-3">
  <div class="card-body">
    <p><strong>Category:</strong> {{ t.category }} | <strong>Status:</strong> {{ t.status }} | <strong>Priority:</strong> {{ t.priority }}</p>
    <p><strong>Department:</strong> {{ t.department.name if t.department else '-' }}</p>
    <p><strong>Assigned To:</strong> {{ t.assignee.name if t.assignee else 'Unassigned' }}</p>
    <p><strong>Due:</strong> {{ t.due_at.strftime('%Y-%m-%d %H:%M') if t.due_at else '-' }}</p>
    <p>{{ t.description }}</p>
  </div>
</div>

{% if current_user.role in ['OFFICER','ADMIN'] %}
<form class="mb-3" method="post" action="{{ url_for('update_status', ticket_id=t.id) }}">
  <div class="row g-2 align-items-end">
    <div class="col-auto">
      <label class="form-label">Update Status</label>
      <select name="status" class="form-select">
        <option value="OPEN" {% if t.status=='OPEN' %}selected{% endif %}>OPEN</option>
        <option value="IN_PROGRESS" {% if t.status=='IN_PROGRESS' %}selected{% endif %}>IN PROGRESS</option>
        <option value="RESOLVED" {% if t.status=='RESOLVED' %}selected{% endif %}>RESOLVED</option>
        <option value="CLOSED" {% if t.status=='CLOSED' %}selected{% endif %}>CLOSED</option>
      </select>
    </div>
    <div class="col-auto">
      <button class="btn btn-outline-primary">Save</button>
    </div>
  </div>
</form>
{% endif %}

<h5>Comments</h5>
<ul class="list-group mb-3">
  {% for c in t.comments %}
  <li class="list-group-item">
    <strong>{{ c.user.name }}</strong> <small class="text-muted">{{ c.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
    <div>{{ c.body }}</div>
  </li>
  {% else %}
  <li class="list-group-item">No comments.</li>
  {% endfor %}
</ul>

<form method="post">
  <div class="mb-3">
    <label class="form-label">Add Comment</label>
    <textarea name="body" class="form-control" rows="3"></textarea>
  </div>
  <button class="btn btn-primary">Post Comment</button>
</form>
{% endblock %}
